# S3の概要

## AWSストレージサービス
AWSは３つの形式のストレージサービスを提供
### ブロックストレージ(Block Storage)
- EC2にアタッチして活用するディスクサービス
- ブロック形式でデータを保存
- 高度・広帯域幅（bandwidth）
- ex)EBS、インスタンスストア
### オブジェクトストレージ（Object Storage）
- 安価かつ安い耐久性をもつオンラインストレージ
- オブジェクト形式でデータを保存
- ex)S3、Glacier
### ファイルストレージ（File Storage）
- 複数のEC2インスタンスから同時にアタッチ可能な共有ストレージサービス
- ファイル形式でデータを保存
- ex)EFS

## Simple Storage Service（S3）
ユーザがデータを容量制限なく保存可能なマネージド型で提供されるオブジェクト型ストレージ
### 特徴
- 高い耐久性：99.999999999%
- 安価なストレージ：月額1GB/3円
- スケーラブルで安定した性能：データは冗長化（じょうちょうか）されて保存されデータ容量に依存しない性能がAWS側で保証される
- 暗号化：転送中や保存時にデータを暗号化可能
### データ保存形式
- バケット：オブジェクトの保存場所。名前はグローバルでユニークな必要あり
- オブジェクト：S3に格納されるファイルでURLが付与される。バケット内オブジェクト数は無制限
- データサイズ
データサイズは0KBから5TBまで保存可能

## オブジェクト構成
- Key：オブジェクトの名前
- Value：データそのものであり、バイト値で構成される
- バージョンID：バージョン管理に用いるID
- メタデータ：オブジェクトに付随（ふずい・부수、관련된、연관된）する属性の情報
- サブリソース：ex) ACLやバケットポリシ

## S3のデータ構造
S3
↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓
ベケット　ベケット
↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓
オブジェクト　オブジェクト　オブジェクト　オブジェクト

## AWSストレージサービス
S3の用途に応じてストレージタイプを選択する
- STANDARD：複数箇所にデータを複製するため、耐久性が高い
- STANDARD-IA：30日以上維持すると、$0.0125/GB、検索は$0.01/GB *IAは可用性が低いけど安い
- One Zone-IA：安全ではないデータを置くときに使用、STANDARD-IAより20%くらい安い
- RRS（Reduced Redundancy Storage）：非推薦、耐久性低い、可用性低い
- Amazon Glacier：めっちゃ安いけど、データ抽出にコストと時間がかかる、$0.00099/GB

## S3 Intelligent-Tiering
低頻度アクセスのオブジェクトを自動的に低頻度アクセス層に移動することでコストを安くする
代わりに、データ抽出に時間がかかる

## S3の生合成モデル
S3は高い可用性を実現するため、データ更新・削除には結果整合生モデルを採用。
同時書込みはタイムスタンプ処理を実施

## S3のアクセス管理
S3のアクセス管理は用途に応じて方式を使い分ける
- IAMユーザーポリシー：IAMユーザーに対してS3サービスへのアクセス権限を設定することができる。一元的にユーザー権限を管理
- バケットポリシー：バケット自体のアクセス権限を制御。アクセス権をJSONで設定
- ACL(Access control list）：：オブジェクトへのアクセス権限をXMLで設定する
- 署名付きURL：一時的なアクセスを許可させるため、AWS SDKで生成した署名付きURLで共有

## S3の暗号化
S3へのデータ保管時に暗号化として以下の4つの形式から選択する

- SSE-S3：一番標準的な方式、暗号化キーの作成・管理をS3側で自動で実施
- SSE-KMS：AWS KMSに設定した暗号化キーを利用した暗号化を実施
- SSE-C：ユーザーが指定したキーによるサーバー側での暗号化を使用することが可能
- クライアントサイド暗号化（CSE）：クライアント側の暗号化では、AmazonS3に送信する前にデータを暗号化する方式

## S3アクセスポイント
S3上の共有データセットを使用するアプリケーションへの大規模なデータアクセス管理を実施
### 作り方
- アクセスポイント作成
- アクセス制御設定
- VPCアクセス制限設定
- アクセス管理の実行

## S3アクセスアナライザー
アクセスポリシーに沿っているかを確認し、不正なアクセスが発生していないか、アクセスポリシーを監視する機能
- IAMアクセスアナライザー（IAM上の機能）に連動したS3向けの機能
- バケットポリシー/ACLのモニタリング
- パブリックまたは共有バケットアクセスを検出
- バケットポリシー、バケットACLまたはその両方。バケットアクセスのソースを検索して確認する場合は、この列の情報をまず使用して、迅速で正確なアクセス、位置で実行する
- 全てのパブリックバケットと共有バケットの結果を表示する
- バケットの実際のアクセス状況を確認する

## ライフサイクル管理
バケット内のオブジェクト単位でストレージクラスの変更や削除時期などを設定することで実行自動化する
- 一定期間で自動アーカイブ（Standard S3　ー＞　Glacier）
- 一定期間で自動さ安価な保存場所へ（Standard S3　ー＞　Standard-IA S3
- 一定期間で自動で削除
Standard S3　ー＞　削除

## レプリケーション
リージョン間を超える、跨ぐ（またぐ）クロスリージョンレプリケーションにより耐障害性（たいしょうがいせい）を高める

* 耐障害性：フォールトトレランス（fault tolerance) のこと。障害などの問題が発生しても性能や機能を制限することなく、動かし続けるための備え（そなえ）のこと

### レプリケーションのトリガー
バケットに対するオブジェクト作成・更新・削除をトリガーにレプリケーションを実行する

### 設定
- バージョニング機能を有効にする
- バケットは各別（かくべつ）リージョンを指定
- 双方向（そうほうこう）レプリケーションも可能
- データ転送費用が発生

## バージョン管理
ユーザーによる間違いでデータ削除などが発生してもバージョンから復元できる
- バケットをバージョン管理する
- バージョン保管されたオブジェクトを参照可能
- ライフサイクル管理によって保存する期間の指定も可能
- バケット削除時に古いバージョンのベッド削除が必要

## バックアップ
Glacierを利用してバックアップと復元が実施可能
### アーカイブ
- 複数リージョンでレプリケーションすることが可能
- S3オブジェクトデータをライフサイクル設定によりGlacierに移動
### リストア
- バージョン管理可能によって削除されたデータを復元するのが基本

##　利用状況の確認
S3の利用状況やS3のイベント発生を確認することが可能

## S3データの解析
S3内のデータ検索・解析には用途に応じて複数サービスから選択が可能
### S3 Select（Glacier Select）
- S3の内部機能として有している検索機能で、S3内で直接クエリを実行し、データを取得できる
- GZIP圧縮データやCSVやJSONに対して実行可能
### Amazon Athena
- Amazon S3内のデータを直接、簡単に分析できるようにするインタラクティブなクエリサービス
- Athena SQLクエリでSageMaker機械学習モデルを呼び出し、機械学習による推論も実行可能
### Amazon Macie
- 機械学習のよりAmazon S3の機密データ検出、分類、保管する、降るマネージド型サービス
- 機密データ検出や調査を実施する
### Amazon Redshift Spectrum
- Amazon S3の格納データに対して、Amazon Redshiftから直接クエリを実行できる機能
- Redshiftクラスターが起動されている前提であるため、Redshiftを利用している場合におすすめ

## CORS（クロスオリジンリソースジェアリング）
Cross origin resource shareringにより、特定のドメインにロードされたアプリケーじょんが異なるドメイン内のリソースと通信する方法を定義

## マルチパートアップロード
大容量オブジェクトをいくつか分けてアップロードする機能

## バッチオペレーション
S3オブジェクトの大量データに対して、一括処理を実行することが可能

### ジョブ
- ジョブはS3バッチオペレーションの機能の基本単位で、ジョブを作成することでバッチオペレーションを作成
- ジョブにはオブジェクトのリストに対して指定された操作を実行するために必要な全ての情報を登録
- S3バッチオペレーションにオブジェクトのリストを渡し、それらのオブジェクトに対して実行するアクションを指定

### マニュフェスト
- マニュフェストとは、Amazon S3が作用するオブジェクトキーをリストするAmazon S3 オブジェクト
- マニュフェストオブジェクトキー、ETag、及びオプションでバージョンIDを指定
- Amazon S3インベントリレポート/CSVファイルの２つの形式で指定