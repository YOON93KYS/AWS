# VPCとの接続

## VPCとのオンプレミス接続

### VPN接続

### Direct Connect
お客様のデータセンターやオフィスを専用線などを介してAWSへプライベートに接続するサービス

#### メリット
- 安価なアウトバウンドトラフィック料金
- ネットワーク信頼性が高い

#### 仕組み
Direct Connectロケーションに物理的に自社オンプレ環境を接続することでAWS環境との専用線接続を実現する

### Direct Connect gateway
Direct Connect gatewayにより、同一アカウントに所属する複数リージョンの複数AZから複数リージョンの複数VPCに接続

## VPNとのDirect Connect
VPNの方が安く素早く利用できるが、信頼性や品質は専用線が勝る

### VPN
- コスト：安価なベストエフォート回線が利用可能
- リードタイム：クラウド上での接続設定で可能なためすぐ
- 広域幅：暗号化のオーバーヘッドにより制限がある
- 品質：インターネット経由のためネットワーク状態の影響をウケる
- 障害切り分け：インターネットベースのため自社で保持している範囲以外の確認は厳しい
### 専用線
- コスト：キャリアの専用線サービス契約が必要となりVPNより割高
- リードタイム：物理対応が必要なため数週間
- 広域幅：ポートあたり1G/10Gbps
- 品質：キャリアにより高い品質が補正される
- 障害切り分け：物理的に経由がかくぼされているため比較的簡単

## VPCエンドポイント
VPCエンドポイントはグローバルIPをもつAWSサービスに対して、VPC内から直接アクセスするための出口
Gateway型はサブネットに特殊なルーティングを設定し、VPC内部から直接外のサービスを通信する
PrivateLink型はサブネットにエンドポイント用のプライベートIPアドレスを生成し、DNSが名前解決でルーティングする

## NATゲートウェイ
NATゲートウェイによりプライベートサブネットのリソースがインターネットまたはAWSクラウドと通信が可能になる

## VPC Flow logs
VPC Flow Logsはネットワークトラフィックを取得し、CloudWatchでモニタリングできるようにする機能

- ネットワークインタフェースを送信先/受信先とするトラフィックが対象
- セキュリティグループとネットワークACLのルールでaccepted/rejectsされたトラフィックログを取得
- キャプチャウィンドウと言わせれる時間（10分間）で収集・プロセッシング・保存する
- RDS、Redshift、ElasticCache、WorSpeacesのネットワークインタフェーストラフィックも取得可能
- 追加料金なし

## VPCを分割するケース
アプリサービスや組織構成などの用途に応じてVPCを分割する
- アプリケーションによる分割
- 監査のスコープによる分割
- リスクレベルによる分割
- 本番/検証/開発フェーズによる分割
- 部署による分割 共通サービスの切り出し

## VPC Peering
VPC preeringにより２つのVPC間でのトラフィックルーティングが可能
- 異なるAWSアカウント間のVPC間をピア接続可能
- 一部のリージョン間の異なるVPC間のピア接続も可能
- 単一障害点や帯域幅のボトルネックは存在しない